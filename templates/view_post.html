{% extends "base.html" %}

{% block title %}Home - Blog Site{% endblock %}

{% block content %}
<div class="post-full">
    <article>
        <h2>{{ post.title }}</h2>
        <p class="post-meta">
            By {{ post.author.username }} | {{ post.created_at.strftime('%B %d, %Y at %I:%M %p') }}
            {% if post.updated_at != post.created_at %}
                <span class="edited">(Edited: {{ post.updated_at.strftime('%B %d, %Y') }})</span>
            {% endif %}
        </p>

        <div class="post-content">
            {{ post.content | safe }}
        </div>

        {% if current_user.is_authenticated and current_user.is_admin %}
            <div class="post-actions">
                <a href="{{ url_for('edit_post', id=post.id) }}" class="btn btn-edit">Edit</a>
                <a href="{{ url_for('delete_post', id=post.id) }}" class="btn-delete" onclick="return confirm('Are you sure you want to delete this post?');">Delete</a>
            </div>
        {% endif %}
    </article>
    <section class="comments-section">
        <h3>Comments ({{ post.comments|length }})</h3>

        {% if current_user.is_authenticated %}
            <form method="POST" action="{{ url_for('add_comment', post_id=post.id) }}" class="comment-form">
                <textarea name="content" placeholder="Add your comment here..." required></textarea>
                <button type="submit">Post Comment</button>
            </form>
        {% else %}
            <p><a href="{{ url_for('login') }}">Log in</a> to post a comment.</p>
        {% endif %}

        <div class="comments-list">
            {% for comment in post.comments %}
                <div class="comment">
                    <p class="comment-meta">
                        <strong>{{ comment.author.username }}</strong> | {{ comment.created_at.strftime('%B %d, %Y at %I:%M %p') }}
                    </p>
                    <p class="comment-content">{{ comment.content }}</p>

                    {% if current_user.is_authenticated and (current_user.id == comment.author.id or current_user.is_admin) %}
                        <a href="{{ url_for('delete_comment', id=comment.id) }}" class="btn-delete-comment" onclick="return confirm('Delete this comment?')">Delete</a>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </section>
</div>
{% endblock %}